<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¹çŸ³ä¸­å­¦è¡¨ç™½å¢™ - ä¸»é¡µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo h1 {
            font-size: 20px;
        }
        
        .logo p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .btn-primary {
            background: #ff7e5f;
        }
        
        .btn-primary:hover {
            background: #e86f51;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .main-content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .sidebar {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            height: fit-content;
        }
        
        .post-form {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .post-input {
            width: 100%;
            min-height: 80px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            resize: vertical;
        }
        
        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .icon-btn:hover {
            color: #6a11cb;
        }
        
        .posts {
            padding: 10px;
        }
        
        .post {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .post:last-child {
            border-bottom: none;
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6a11cb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .username {
            font-weight: bold;
        }
        
        .timestamp {
            font-size: 12px;
            color: #888;
        }
        
        .post-content {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .post-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .post-actions {
            display: flex;
            gap: 15px;
        }
        
        .post-stats {
            display: flex;
            gap: 15px;
            color: #888;
            font-size: 14px;
        }
        
        .featured-badge {
            background: #ff7e5f;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .admin-badge {
            background: #6a11cb;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .muted-badge {
            background: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            font-size: 12px;
            color: #666;
            margin-top: 40px;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-panel {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .admin-btn {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .admin-btn:hover {
            background: #5a0db9;
        }
        
        .liked {
            color: #ff7e5f !important;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <h1>é¹çŸ³ä¸­å­¦è¡¨ç™½å¢™</h1>
                <p>åˆ†äº«å¿ƒå£°ï¼Œä¼ é€’æ¸©æš–</p>
            </div>
            <div class="user-actions">
                <button class="btn" id="profile-btn">ä¸ªäººèµ„æ–™</button>
                <button class="btn btn-primary" id="logout-btn">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="main-content">
            <div class="post-form">
                <textarea class="post-input" placeholder="åˆ†äº«ä½ çš„å¿ƒå£°..."></textarea>
                <div class="post-actions">
                    <div class="action-buttons">
                        <button class="icon-btn">
                            <i>ğŸ“·</i> å›¾ç‰‡
                        </button>
                        <button class="icon-btn">
                            <i>ğŸ˜Š</i> è¡¨æƒ…
                        </button>
                    </div>
                    <button class="btn btn-primary" id="post-btn">å‘å¸ƒ</button>
                </div>
            </div>
            
            <div class="posts" id="posts-container">
                <!-- å¸–å­å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="sidebar">
            <h2 class="section-title">ç²¾åå¸–å­</h2>
            <div id="featured-posts">
                <!-- ç²¾åå¸–å­å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div id="admin-panel" style="display: none;">
                <h2 class="section-title">ç®¡ç†é¢æ¿</h2>
                <button class="admin-btn" id="manage-posts">å¸–å­ç®¡ç†</button>
                <button class="admin-btn" id="manage-users">ç”¨æˆ·ç®¡ç†</button>
                <button class="admin-btn" id="set-featured">è®¾ç½®ç²¾å</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>by 2025å±Š904ç­å‘¨æ–‡åšåŒå­¦ï¼ŒQQ:3637457102</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const postsContainer = document.getElementById('posts-container');
            const featuredPostsContainer = document.getElementById('featured-posts');
            const adminPanel = document.getElementById('admin-panel');
            const logoutBtn = document.getElementById('logout-btn');
            const postBtn = document.getElementById('post-btn');
            const postInput = document.querySelector('.post-input');
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (!currentUser.username) {
                alert('è¯·å…ˆç™»å½•ï¼');
                window.location.href = 'login.html';
                return;
            }
            
            // æ˜¾ç¤ºç®¡ç†å‘˜é¢æ¿
            if (currentUser.role === 'admin' || currentUser.role === 'superadmin') {
                adminPanel.style.display = 'block';
            }
            
            // é€€å‡ºç™»å½•
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            });
            
            // å‘å¸ƒå¸–å­
            postBtn.addEventListener('click', function() {
                if (currentUser.muted) {
                    alert('æ‚¨å·²è¢«ç¦è¨€ï¼Œæ— æ³•å‘å¸ƒå¸–å­ï¼');
                    return;
                }
                
                const content = postInput.value.trim();
                if (content === '') {
                    alert('å¸–å­å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                    return;
                }
                
                // åˆ›å»ºæ–°å¸–å­
                const newPost = {
                    id: Date.now().toString(),
                    author: currentUser.username,
                    content: content,
                    timestamp: new Date().toISOString(),
                    likes: 0,
                    likedBy: [], // å­˜å‚¨ç‚¹èµç”¨æˆ·çš„æ•°ç»„
                    comments: [],
                    isFeatured: false,
                    image: null
                };
                
                // ä¿å­˜å¸–å­
                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                posts.unshift(newPost);
                localStorage.setItem('posts', JSON.stringify(posts));
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                postInput.value = '';
                
                // é‡æ–°æ¸²æŸ“å¸–å­
                renderPosts();
                alert('å‘å¸ƒæˆåŠŸï¼');
            });
            
            // æ¸²æŸ“å¸–å­
            function renderPosts() {
                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                postsContainer.innerHTML = '';
                featuredPostsContainer.innerHTML = '';
                
                // åˆ†ç¦»ç²¾åå¸–å’Œæ™®é€šå¸–
                const featuredPosts = posts.filter(post => post.isFeatured);
                const normalPosts = posts.filter(post => !post.isFeatured);
                
                // æ¸²æŸ“ç²¾åå¸–åˆ°ä¾§è¾¹æ 
                if (featuredPosts.length > 0) {
                    featuredPosts.forEach(post => {
                        const postElement = createPostElement(post, true);
                        featuredPostsContainer.appendChild(postElement);
                    });
                } else {
                    featuredPostsContainer.innerHTML = '<p>æš‚æ— ç²¾åå¸–å­</p>';
                }
                
                // æ¸²æŸ“æ‰€æœ‰å¸–å­åˆ°ä¸»åŒºåŸŸï¼ˆç²¾åå¸–ç½®é¡¶ï¼‰
                [...featuredPosts, ...normalPosts].forEach(post => {
                    const postElement = createPostElement(post, false);
                    postsContainer.appendChild(postElement);
                });
            }
            
            // åˆ›å»ºå¸–å­å…ƒç´ 
            function createPostElement(post, isCompact) {
                const postEl = document.createElement('div');
                postEl.className = 'post';
                
                // ç¡®ä¿likedByæ•°ç»„å­˜åœ¨
                if (!post.likedBy) {
                    post.likedBy = [];
                }
                
                // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµ
                const isLiked = post.likedBy.includes(currentUser.username);
                
                // è·å–ä½œè€…ä¿¡æ¯
                const authorData = JSON.parse(localStorage.getItem('user_' + post.author) || '{}');
                
                postEl.innerHTML = `
                    <div class="post-header">
                        <div class="user-info">
                            <div class="avatar">${post.author.charAt(0)}</div>
                            <div class="user-details">
                                <div class="username">
                                    ${post.author}
                                    ${authorData.role === 'admin' || authorData.role === 'superadmin' ? '<span class="admin-badge">ç®¡ç†å‘˜</span>' : ''}
                                    ${authorData.muted ? '<span class="muted-badge">å·²ç¦è¨€</span>' : ''}
                                    ${post.isFeatured ? '<span class="featured-badge">ç²¾å</span>' : ''}
                                </div>
                                <div class="timestamp">${new Date(post.timestamp).toLocaleString()}</div>
                            </div>
                        </div>
                        ${(currentUser.role === 'admin' || currentUser.role === 'superadmin') ? 
                        `<div class="post-actions">
                            <button class="icon-btn delete-btn" data-id="${post.id}">åˆ é™¤</button>
                            ${!post.isFeatured ? `<button class="icon-btn feature-btn" data-id="${post.id}">åŠ ç²¾</button>` : ''}
                        </div>` : ''}
                    </div>
                    <div class="post-content">${post.content}</div>
                    ${post.image ? `<img src="${post.image}" class="post-image">` : ''}
                    <div class="post-footer">
                        <div class="post-stats">
                            <span class="likes">${post.likes} èµ</span>
                            <span class="comments">${post.comments.length} è¯„è®º</span>
                        </div>
                        <div class="post-actions">
                            <button class="icon-btn like-btn ${isLiked ? 'liked' : ''}" data-id="${post.id}">
                                <i>${isLiked ? 'â¤ï¸' : 'ğŸ‘'}</i> ${isLiked ? 'å·²èµ' : 'èµ'}
                            </button>
                            <button class="icon-btn comment-btn" data-id="${post.id}">
                                <i>ğŸ’¬</i> è¯„è®º
                            </button>
                            <button class="icon-btn share-btn" data-id="${post.id}">
                                <i>ğŸ“¤</i> åˆ†äº«
                            </button>
                        </div>
                    </div>
                `;
                
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                if (!isCompact) {
                    const likeBtn = postEl.querySelector('.like-btn');
                    likeBtn.addEventListener('click', function() {
                        let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                        const postIndex = posts.findIndex(p => p.id === post.id);
                        
                        if (postIndex !== -1) {
                            // ç¡®ä¿likedByæ•°ç»„å­˜åœ¨
                            if (!posts[postIndex].likedBy) {
                                posts[postIndex].likedBy = [];
                            }
                            
                            const userIndex = posts[postIndex].likedBy.indexOf(currentUser.username);
                            
                            if (userIndex === -1) {
                                // ç”¨æˆ·æœªç‚¹èµï¼Œæ·»åŠ ç‚¹èµ
                                posts[postIndex].likes++;
                                posts[postIndex].likedBy.push(currentUser.username);
                                likeBtn.innerHTML = '<i>â¤ï¸</i> å·²èµ';
                                likeBtn.classList.add('liked');
                            } else {
                                // ç”¨æˆ·å·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ
                                posts[postIndex].likes--;
                                posts[postIndex].likedBy.splice(userIndex, 1);
                                likeBtn.innerHTML = '<i>ğŸ‘</i> èµ';
                                likeBtn.classList.remove('liked');
                            }
                            
                            localStorage.setItem('posts', JSON.stringify(posts));
                            
                            // æ›´æ–°ç‚¹èµè®¡æ•°æ˜¾ç¤º
                            postEl.querySelector('.likes').textContent = `${posts[postIndex].likes} èµ`;
                        }
                    });
                    
                    // ç®¡ç†å‘˜åŠŸèƒ½
                    if (currentUser.role === 'admin' || currentUser.role === 'superadmin') {
                        const deleteBtn = postEl.querySelector('.delete-btn');
                        deleteBtn.addEventListener('click', function() {
                            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å¸–å­å—ï¼Ÿ')) {
                                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                                posts = posts.filter(p => p.id !== post.id);
                                localStorage.setItem('posts', JSON.stringify(posts));
                                renderPosts();
                            }
                        });
                        
                        const featureBtn = postEl.querySelector('.feature-btn');
                        if (featureBtn) {
                            featureBtn.addEventListener('click', function() {
                                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                                const postIndex = posts.findIndex(p => p.id === post.id);
                                if (postIndex !== -1) {
                                    posts[postIndex].isFeatured = true;
                                    localStorage.setItem('posts', JSON.stringify(posts));
                                    renderPosts();
                                }
                            });
                        }
                    }
                }
                
                return postEl;
            }
            
            // åˆå§‹åŒ–æ¸²æŸ“
            renderPosts();
            
            // å¦‚æœæ²¡æœ‰å¸–å­ï¼Œæ·»åŠ ä¸€äº›ç¤ºä¾‹å¸–å­
            let posts = JSON.parse(localStorage.getItem('posts') || '[]');
            if (posts.length === 0) {
                const samplePosts = [
                    {
                        id: '1',
                        author: '2025å±Š904ç­å‘¨æ–‡åšåŒå­¦',
                        content: 'æ¬¢è¿ä½¿ç”¨é¹çŸ³ä¸­å­¦è¡¨ç™½å¢™ï¼åœ¨è¿™é‡Œä½ å¯ä»¥åˆ†äº«å¿ƒå£°ï¼Œè¡¨è¾¾æƒ…æ„Ÿã€‚',
                        timestamp: new Date().toISOString(),
                        likes: 42,
                        likedBy: ['2025å±Š904ç­å‘¨æ–‡åšåŒå­¦'],
                        comments: [],
                        isFeatured: true,
                        image: null
                    },
                    {
                        id: '2',
                        author: '2024å±Š901ç­æåŒå­¦',
                        content: 'æ„Ÿè°¢å­¦æ ¡ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¹ˆå¥½çš„äº¤æµå¹³å°ï¼',
                        timestamp: new Date(Date.now() - 86400000).toISOString(),
                        likes: 28,
                        likedBy: ['2024å±Š901ç­æåŒå­¦'],
                        comments: [],
                        isFeatured: false,
                        image: null
                    }
                ];
                
                localStorage.setItem('posts', JSON.stringify(samplePosts));
                renderPosts();
            }
        });
    </script>
</body>
</html>
