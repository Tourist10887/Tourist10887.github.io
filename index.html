<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈπûÁü≥‰∏≠Â≠¶Ë°®ÁôΩÂ¢ô - ‰∏ªÈ°µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo h1 {
            font-size: 20px;
        }
        
        .logo p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .btn-primary {
            background: #ff7e5f;
        }
        
        .btn-primary:hover {
            background: #e86f51;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .main-content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .sidebar {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            height: fit-content;
        }
        
        .post-form {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .post-input {
            width: 100%;
            min-height: 80px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            resize: vertical;
        }
        
        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .icon-btn:hover {
            color: #6a11cb;
        }
        
        .posts {
            padding: 10px;
        }
        
        .post {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .post:last-child {
            border-bottom: none;
        }
        
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6a11cb;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .username {
            font-weight: bold;
        }
        
        .timestamp {
            font-size: 12px;
            color: #888;
        }
        
        .post-content {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .post-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .post-actions {
            display: flex;
            gap: 15px;
        }
        
        .post-stats {
            display: flex;
            gap: 15px;
            color: #888;
            font-size: 14px;
        }
        
        .featured-badge {
            background: #ff7e5f;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .admin-badge {
            background: #6a11cb;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .muted-badge {
            background: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            font-size: 12px;
            color: #666;
            margin-top: 40px;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .admin-panel {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .admin-btn {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            background: #6a11cb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .admin-btn:hover {
            background: #5a0db9;
        }
        
        .liked {
            color: #ff7e5f !important;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <h1>ÈπûÁü≥‰∏≠Â≠¶Ë°®ÁôΩÂ¢ô</h1>
                <p>ÂàÜ‰∫´ÂøÉÂ£∞Ôºå‰º†ÈÄíÊ∏©Êöñ</p>
            </div>
            <div class="user-actions">
                <button class="btn" id="profile-btn">‰∏™‰∫∫ËµÑÊñô</button>
                <button class="btn btn-primary" id="logout-btn">ÈÄÄÂá∫ÁôªÂΩï</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="main-content">
            <div class="post-form">
                <textarea class="post-input" placeholder="ÂàÜ‰∫´‰Ω†ÁöÑÂøÉÂ£∞..."></textarea>
                <div class="post-actions">
                    <div class="action-buttons">
                        <button class="icon-btn">
                            <i>üì∑</i> ÂõæÁâá
                        </button>
                        <button class="icon-btn">
                            <i>üòä</i> Ë°®ÊÉÖ
                        </button>
                    </div>
                    <button class="btn btn-primary" id="post-btn">ÂèëÂ∏É</button>
                </div>
            </div>
            
            <div class="posts" id="posts-container">
                <!-- Â∏ñÂ≠êÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
        
        <div class="sidebar">
            <h2 class="section-title">Á≤æÂçéÂ∏ñÂ≠ê</h2>
            <div id="featured-posts">
                <!-- Á≤æÂçéÂ∏ñÂ≠êÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <div id="admin-panel" style="display: none;">
                <h2 class="section-title">ÁÆ°ÁêÜÈù¢Êùø</h2>
                <button class="admin-btn" id="manage-posts">Â∏ñÂ≠êÁÆ°ÁêÜ</button>
                <button class="admin-btn" id="manage-users">Áî®Êà∑ÁÆ°ÁêÜ</button>
                <button class="admin-btn" id="set-featured">ËÆæÁΩÆÁ≤æÂçé</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>by 2025Â±ä904Áè≠Âë®ÊñáÂçöÂêåÂ≠¶ÔºåQQ:3637457102</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const postsContainer = document.getElementById('posts-container');
            const featuredPostsContainer = document.getElementById('featured-posts');
            const adminPanel = document.getElementById('admin-panel');
            const logoutBtn = document.getElementById('logout-btn');
            const postBtn = document.getElementById('post-btn');
            const postInput = document.querySelector('.post-input');
            
            // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            if (!currentUser.username) {
                alert('ËØ∑ÂÖàÁôªÂΩïÔºÅ');
                window.location.href = 'login.html';
                return;
            }
            
            // ÊòæÁ§∫ÁÆ°ÁêÜÂëòÈù¢Êùø
            if (currentUser.role === 'admin' || currentUser.role === 'superadmin') {
                adminPanel.style.display = 'block';
            }
            
            // ÈÄÄÂá∫ÁôªÂΩï
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            });
            
            // ÂèëÂ∏ÉÂ∏ñÂ≠ê
            postBtn.addEventListener('click', function() {
                if (currentUser.muted) {
                    alert('ÊÇ®Â∑≤Ë¢´Á¶ÅË®ÄÔºåÊó†Ê≥ïÂèëÂ∏ÉÂ∏ñÂ≠êÔºÅ');
                    return;
                }
                
                const content = postInput.value.trim();
                if (content === '') {
                    alert('Â∏ñÂ≠êÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫ÔºÅ');
                    return;
                }
                
                // ÂàõÂª∫Êñ∞Â∏ñÂ≠ê
                const newPost = {
                    id: Date.now().toString(),
                    author: currentUser.username,
                    content: content,
                    timestamp: new Date().toISOString(),
                    likes: 0,
                    likedBy: [], // Â≠òÂÇ®ÁÇπËµûÁî®Êà∑ÁöÑÊï∞ÁªÑ
                    comments: [],
                    isFeatured: false,
                    image: null
                };
                
                // ‰øùÂ≠òÂ∏ñÂ≠ê
                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                posts.unshift(newPost);
                localStorage.setItem('posts', JSON.stringify(posts));
                
                // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
                postInput.value = '';
                
                // ÈáçÊñ∞Ê∏≤ÊüìÂ∏ñÂ≠ê
                renderPosts();
                alert('ÂèëÂ∏ÉÊàêÂäüÔºÅ');
            });
            
            // Ê∏≤ÊüìÂ∏ñÂ≠ê
            function renderPosts() {
                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                postsContainer.innerHTML = '';
                featuredPostsContainer.innerHTML = '';
                
                // ÂàÜÁ¶ªÁ≤æÂçéÂ∏ñÂíåÊôÆÈÄöÂ∏ñ
                const featuredPosts = posts.filter(post => post.isFeatured);
                const normalPosts = posts.filter(post => !post.isFeatured);
                
                // Ê∏≤ÊüìÁ≤æÂçéÂ∏ñÂà∞‰æßËæπÊ†è
                if (featuredPosts.length > 0) {
                    featuredPosts.forEach(post => {
                        const postElement = createPostElement(post, true);
                        featuredPostsContainer.appendChild(postElement);
                    });
                } else {
                    featuredPostsContainer.innerHTML = '<p>ÊöÇÊó†Á≤æÂçéÂ∏ñÂ≠ê</p>';
                }
                
                // Ê∏≤ÊüìÊâÄÊúâÂ∏ñÂ≠êÂà∞‰∏ªÂå∫ÂüüÔºàÁ≤æÂçéÂ∏ñÁΩÆÈ°∂Ôºâ
                [...featuredPosts, ...normalPosts].forEach(post => {
                    const postElement = createPostElement(post, false);
                    postsContainer.appendChild(postElement);
                });
            }
            
            // ÂàõÂª∫Â∏ñÂ≠êÂÖÉÁ¥†
            function createPostElement(post, isCompact) {
                const postEl = document.createElement('div');
                postEl.className = 'post';
                
                // Á°Æ‰øùlikedByÊï∞ÁªÑÂ≠òÂú®
                if (!post.likedBy) {
                    post.likedBy = [];
                }
                
                // Ê£ÄÊü•ÂΩìÂâçÁî®Êà∑ÊòØÂê¶Â∑≤ÁÇπËµû
                const isLiked = post.likedBy.includes(currentUser.username);
                
                // Ëé∑Âèñ‰ΩúËÄÖ‰ø°ÊÅØ
                const authorData = JSON.parse(localStorage.getItem('user_' + post.author) || '{}');
                
                postEl.innerHTML = `
                    <div class="post-header">
                        <div class="user-info">
                            <div class="avatar">${post.author.charAt(0)}</div>
                            <div class="user-details">
                                <div class="username">
                                    ${post.author}
                                    ${authorData.role === 'admin' || authorData.role === 'superadmin' ? '<span class="admin-badge">ÁÆ°ÁêÜÂëò</span>' : ''}
                                    ${authorData.muted ? '<span class="muted-badge">Â∑≤Á¶ÅË®Ä</span>' : ''}
                                    ${post.isFeatured ? '<span class="featured-badge">Á≤æÂçé</span>' : ''}
                                </div>
                                <div class="timestamp">${new Date(post.timestamp).toLocaleString()}</div>
                            </div>
                        </div>
                        ${(currentUser.role === 'admin' || currentUser.role === 'superadmin') ? 
                        `<div class="post-actions">
                            <button class="icon-btn delete-btn" data-id="${post.id}">Âà†Èô§</button>
                            ${!post.isFeatured ? `<button class="icon-btn feature-btn" data-id="${post.id}">Âä†Á≤æ</button>` : ''}
                        </div>` : ''}
                    </div>
                    <div class="post-content">${post.content}</div>
                    ${post.image ? `<img src="${post.image}" class="post-image">` : ''}
                    <div class="post-footer">
                        <div class="post-stats">
                            <span class="likes">${post.likes} Ëµû</span>
                            <span class="comments">${post.comments.length} ËØÑËÆ∫</span>
                        </div>
                        <div class="post-actions">
                            <button class="icon-btn like-btn ${isLiked ? 'liked' : ''}" data-id="${post.id}">
                                <i>${isLiked ? '‚ù§Ô∏è' : 'üëç'}</i> ${isLiked ? 'Â∑≤Ëµû' : 'Ëµû'}
                            </button>
                            <button class="icon-btn comment-btn" data-id="${post.id}">
                                <i>üí¨</i> ËØÑËÆ∫
                            </button>
                            <button class="icon-btn share-btn" data-id="${post.id}">
                                <i>üì§</i> ÂàÜ‰∫´
                            </button>
                        </div>
                    </div>
                `;
                
                // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
                if (!isCompact) {
                    const likeBtn = postEl.querySelector('.like-btn');
                    likeBtn.addEventListener('click', function() {
                        let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                        const postIndex = posts.findIndex(p => p.id === post.id);
                        
                        if (postIndex !== -1) {
                            // Á°Æ‰øùlikedByÊï∞ÁªÑÂ≠òÂú®
                            if (!posts[postIndex].likedBy) {
                                posts[postIndex].likedBy = [];
                            }
                            
                            const userIndex = posts[postIndex].likedBy.indexOf(currentUser.username);
                            
                            if (userIndex === -1) {
                                // Áî®Êà∑Êú™ÁÇπËµûÔºåÊ∑ªÂä†ÁÇπËµû
                                posts[postIndex].likes++;
                                posts[postIndex].likedBy.push(currentUser.username);
                                likeBtn.innerHTML = '<i>‚ù§Ô∏è</i> Â∑≤Ëµû';
                                likeBtn.classList.add('liked');
                            } else {
                                // Áî®Êà∑Â∑≤ÁÇπËµûÔºåÂèñÊ∂àÁÇπËµû
                                posts[postIndex].likes--;
                                posts[postIndex].likedBy.splice(userIndex, 1);
                                likeBtn.innerHTML = '<i>üëç</i> Ëµû';
                                likeBtn.classList.remove('liked');
                            }
                            
                            localStorage.setItem('posts', JSON.stringify(posts));
                            
                            // Êõ¥Êñ∞ÁÇπËµûËÆ°Êï∞ÊòæÁ§∫
                            postEl.querySelector('.likes').textContent = `${posts[postIndex].likes} Ëµû`;
                        }
                    });
                    
                    // ÁÆ°ÁêÜÂëòÂäüËÉΩ
                    if (currentUser.role === 'admin' || currentUser.role === 'superadmin') {
                        const deleteBtn = postEl.querySelector('.delete-btn');
                        deleteBtn.addEventListener('click', function() {
                            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°Â∏ñÂ≠êÂêóÔºü')) {
                                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                                posts = posts.filter(p => p.id !== post.id);
                                localStorage.setItem('posts', JSON.stringify(posts));
                                renderPosts();
                            }
                        });
                        
                        const featureBtn = postEl.querySelector('.feature-btn');
                        if (featureBtn) {
                            featureBtn.addEventListener('click', function() {
                                let posts = JSON.parse(localStorage.getItem('posts') || '[]');
                                const postIndex = posts.findIndex(p => p.id === post.id);
                                if (postIndex !== -1) {
                                    posts[postIndex].isFeatured = true;
                                    localStorage.setItem('posts', JSON.stringify(posts));
                                    renderPosts();
                                }
                            });
                        }
                    }
                }
                
                return postEl;
            }
            
            // ÂàùÂßãÂåñÊ∏≤Êüì
            renderPosts();
            
            // Â¶ÇÊûúÊ≤°ÊúâÂ∏ñÂ≠êÔºåÊ∑ªÂä†‰∏Ä‰∫õÁ§∫‰æãÂ∏ñÂ≠ê
            let posts = JSON.parse(localStorage.getItem('posts') || '[]');
            if (posts.length === 0) {
                const samplePosts = [
                    {
                        id: '1',
                        author: '2025Â±ä904Áè≠Âë®ÊñáÂçöÂêåÂ≠¶',
                        content: 'Ê¨¢Ëøé‰ΩøÁî®ÈπûÁü≥‰∏≠Â≠¶Ë°®ÁôΩÂ¢ôÔºÅÂú®ËøôÈáå‰Ω†ÂèØ‰ª•ÂàÜ‰∫´ÂøÉÂ£∞ÔºåË°®ËææÊÉÖÊÑü„ÄÇ',
                        timestamp: new Date().toISOString(),
                        likes: 42,
                        likedBy: ['2025Â±ä904Áè≠Âë®ÊñáÂçöÂêåÂ≠¶'],
                        comments: [],
                        isFeatured: true,
                        image: null
                    },
                    {
                        id: '2',
                        author: '2024Â±ä901Áè≠ÊùéÂêåÂ≠¶',
                        content: 'ÊÑüË∞¢Â≠¶Ê†°‰∏∫Êàë‰ª¨Êèê‰æõ‰∫ÜËøô‰πàÂ•ΩÁöÑ‰∫§ÊµÅÂπ≥Âè∞ÔºÅ',
                        timestamp: new Date(Date.now() - 86400000).toISOString(),
                        likes: 28,
                        likedBy: ['2024Â±ä901Áè≠ÊùéÂêåÂ≠¶'],
                        comments: [],
                        isFeatured: false,
                        image: null
                    }
                ];
                
                localStorage.setItem('posts', JSON.stringify(samplePosts));
                renderPosts();
            }
        });
    </script>
</body>
</html>
